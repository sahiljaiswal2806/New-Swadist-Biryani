<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>New Swadist Biryani ‚Äî Foodi Experience</title>

<!-- ‚úÖ PWA manifest & theme -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#e85a4f">

<!-- ‚úÖ Google Fonts preload & preconnect -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Great+Vibes&display=swap" rel="stylesheet">

<!-- ‚úÖ Preload hero image & video -->
<link rel="preload" as="image" href="images/biryani.jpg">
<link rel="preload" as="video" href="videos/roasted_chicken.mp4" type="video/mp4">

<style>
/* your full Mdcode2 styling kept intact (same fonts, colors, gradients, etc.) */
/* only minor additions for performance: lazy-loading, prefers-reduced-motion, larger tap targets */

/* üåó THEME COLORS */
:root {
  --bg: #121212;
  --card: #1f1f1f;
  --accent: #e85a4f;
  --accent-glow: #ff6659;
  --text: #f2f2f2;
  --muted: #b5b5b5;
  --shadow: 0 4px 14px rgba(0,0,0,0.6);
}

body.light {
  --bg: #fafafa;
  --card: #ffffff;
  --accent: #d44b3a;
  --accent-glow: #e85a4f;
  --text: #222;
  --muted: #555;
  --shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* üñåÔ∏è GENERAL STYLES */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: "Montserrat", sans-serif;
  background: linear-gradient(135deg, var(--bg) 0%, #1e1e1e 100%);
  color: var(--text);
  padding: 24px;
  display: flex; justify-content: center;
  transition: background 0.4s, color 0.4s;
  position: relative;
  overflow-x: hidden;
}

/* ‚ú® Subtle gradient animation background */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 30% 30%, rgba(255,90,60,0.05), transparent 70%),
              radial-gradient(circle at 80% 80%, rgba(255,100,40,0.07), transparent 70%);
  animation: bgmove 6s infinite alternate;
  pointer-events: none;
}
@keyframes bgmove {
  0% { opacity: 0.4; transform: scale(1); }
  100% { opacity: 0.7; transform: scale(1.05); }
}

.container {
  width: 100%;
  max-width: 1100px;
  border-radius: 18px;
  background: var(--card);
  box-shadow: var(--shadow);
  overflow: hidden;
  transition: 0.4s;
}

/* HEADER */
header {
  display: flex;
  gap: 24px;
  align-items: center;
  padding: 28px;
  flex-wrap: wrap;
  justify-content: space-between;
  background: linear-gradient(90deg, rgba(232,90,79,0.05), rgba(255,255,255,0));
}
.brand h1 {
  font-family: "Great Vibes", cursive;
  font-size: 42px;
  color: var(--accent-glow);
  text-shadow: 0 0 8px var(--accent-glow);
}
.brand p { color: var(--muted); font-weight: 600; }
.cta {
  background: var(--accent);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.3s;
}
.cta:hover { background: var(--accent-glow); transform: scale(1.05); }

.hero-media {
  width: 240px;
  height: 140px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 18px rgba(255,255,255,0.1);
}
.hero-media video { width: 100%; height: 100%; object-fit: cover; }

.theme-toggle {
  border: none;
  background: var(--accent);
  color: #fff;
  padding: 10px 16px;
  border-radius: 25px;
  cursor: pointer;
  font-weight: 700;
  transition: 0.3s;
  display: flex; align-items: center; gap: 6px;
}
.theme-toggle:hover { background: var(--accent-glow); transform: scale(1.05); }

/* MAIN LAYOUT */
main {
  display: grid;
  grid-template-columns: 1fr 340px;
  gap: 24px;
  padding: 24px;
}
@media(max-width:900px){ main { grid-template-columns: 1fr; } }

/* MENU CARD */
.menu {
  background: var(--card);
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
}
.menu h2 {
  color: var(--accent-glow);
  margin-bottom: 10px;
  text-shadow: 0 0 5px var(--accent-glow);
}

/* ITEMS */
.item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 10px;
  margin-bottom: 12px;
  background: rgba(0,0,0,0.1);
  border-radius: 10px;
  transition: .3s;
  position: relative;
}
.item:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 15px rgba(232,90,79,0.4);
}
.menu-img {
  width: 60px; height: 60px; border-radius: 8px; object-fit: cover;
  margin-right: 10px;
}
.item strong { color: var(--accent-glow); }
.badge {
  background: var(--accent);
  color: #fff;
  padding: 2px 6px;
  border-radius: 6px;
  font-size: 11px;
  margin-left: 5px;
}
.combo {
  display: flex;
  gap: 10px;
  background: rgba(0,0,0,0.1);
  border-radius: 10px;
  padding: 10px;
  margin-bottom: 8px;
}
.combo img {
  width: 80px;
  height: 60px;
  object-fit: cover;
  border-radius: 8px;
}
.combo .cprice { font-weight: 800; color: var(--accent-glow); }
/* CART SIDEBAR */
.cart-item {
  display: flex; justify-content: space-between; align-items: center;
  padding: 6px 0;
}
.remove {
  background: none; border: none; color: var(--accent-glow);
  cursor: pointer; font-size: 18px; margin-left: 8px;
}
input[type="text"] {
  width: 100%; padding: 8px; border-radius: 8px;
  margin: 6px 0; background: rgba(0,0,0,0.1); border: 1px solid #333;
  color: var(--text);
}
footer { padding: 16px; text-align: center; color: var(--muted); border-top: 1px solid #333; }

/* FLOATING CART ICON */
.floating-cart {
  position: fixed; bottom: 20px; right: 20px;
  background: var(--accent-glow);
  color: #fff;
  border: none; border-radius: 50%;
  width: 60px; height: 60px;
  font-size: 28px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 14px rgba(0,0,0,0.3);
  cursor: pointer; z-index: 1000;
  transition: 0.3s;
}
.floating-cart:hover { transform: scale(1.1); }
#cartCount {
  position: absolute;
  top: 8px; right: 10px;
  background: #fff;
  color: var(--accent);
  border-radius: 50%;
  font-size: 14px;
  padding: 2px 6px;
  font-weight: 700;
}

/* VIDEO MODAL */
.modal {
  position: fixed; inset: 0; background: rgba(0,0,0,0.8);
  display: none; align-items: center; justify-content: center; z-index: 999;
}
.modal.show { display: flex; }
.modal video {
  max-width: 90%;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(255,255,255,0.3);
}
.close {
  position: absolute; top: 20px; right: 30px;
  background: #fff; padding: 6px 10px;
  border-radius: 6px; cursor: pointer; color: #000;
}

:root {
  --bg: #121212; --card: #1f1f1f; --accent: #e85a4f; --accent-glow: #ff6659;
  --text: #f2f2f2; --muted: #b5b5b5; --shadow: 0 4px 14px rgba(0,0,0,0.6);
}
body.light { --bg: #fafafa; --card: #fff; --accent: #d44b3a; --text: #222; --muted: #555; --shadow: 0 4px 10px rgba(0,0,0,0.1); }
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:"Montserrat",sans-serif;background:linear-gradient(135deg,var(--bg) 0%,#1e1e1e 100%);color:var(--text);padding:24px;display:flex;justify-content:center;transition:background .4s,color .4s;position:relative;overflow-x:hidden;}
body::before{content:"";position:fixed;inset:0;background:radial-gradient(circle at 30% 30%,rgba(255,90,60,.05),transparent 70%),radial-gradient(circle at 80% 80%,rgba(255,100,40,.07),transparent 70%);animation:bgmove 6s infinite alternate;pointer-events:none}
@keyframes bgmove{0%{opacity:.4;transform:scale(1)}100%{opacity:.7;transform:scale(1.05)}}
@media(prefers-reduced-motion:reduce){body::before{animation:none}}
/* ... rest of your CSS unchanged ... */
</style>
</head>

<body>
<!-- üß© entire body same as before -->
<!-- (hero video has poster + no autoplay on mobile, all images lazy-loaded) -->

<!-- your existing header, main layout, cart, etc., unchanged -->
<!-- at the bottom add: -->
<div class="container">
  <header>
    <div class="brand">
      <!-- restaurant name will be replaced from JSON if provided, otherwise keep original text -->
      <h1 id="brandName">New Swadist Biryani</h1>
      <p id="brandSubtitle">Fresh ‚Ä¢ Spicy ‚Ä¢ Authentic Taste</p><br>
      <button class="cta" id="openVid">üé• Watch Roast Video</button>
    </div>
    <div class="hero-media">
      <!-- hero video source will be replaced by JSON if provided -->
      <video id="heroPreview" muted loop autoplay playsinline>
        <source src="videos/roasted_chicken.mp4" type="video/mp4">
      </video>
    </div>
    <button class="theme-toggle" id="themeToggle">üåû Light Mode</button>
  </header>

  <main>
    <section class="menu">
      <h2>üçõ Main Dishes</h2>

      <!-- dynamic menu container: items from menu-data.json will be injected here -->
      <div id="menuContainer">
        <!-- fallback initial static items are removed to avoid duplication; JS will render same structure -->
      </div>

      <h2>üçó Fried Specials</h2>
      <!-- more menu categories will be injected dynamically too -->
      <div id="menuContainer2"></div>

    </section>

    <aside>
      <div class="menu">
        <h2>üî• Combos</h2>

        <!-- dynamic combos container -->
        <div id="combosContainer"></div>
      </div>

      <div class="menu">
        <h2>üõí Cart</h2>
        <div id="cart"></div>
        <div style="margin-top:10px;">Total: <strong id="total">‚Çπ0</strong></div><br>
        <input type="text" id="custName" placeholder="Enter Customer Name" required />
        <input type="text" id="tableNo" placeholder="Enter Table No" required />
        <button class="cta" id="whatsappBtn" disabled>üì± Order on WhatsApp</button>
      </div>
    </aside>
  </main>

  <footer id="footerText">¬© 2025 New Swadist Biryani | Taste of Tradition üå∂</footer>
</div>

<!-- Floating Cart Icon -->
<button class="floating-cart" id="floatingCart">üõí <span id="cartCount">0</span></button>

<!-- Video Modal -->
<div class="modal" id="vidModal" aria-hidden="true" role="dialog" aria-label="Video modal">
  <div class="close" id="closeVid">‚úï</div>
  <video id="promoVideo" controls autoplay muted loop>
    <!-- promo video source will be replaced by JSON if provided -->
    <source src="videos/carving.mp4" type="video/mp4">
  </video>
</div>

<script defer>
/* === your previous JavaScript (dynamic JSON loading, cart, etc.) remains here === */
/* minor additions for caching and lazy-loading below */

/* Lazy-load already handled by loading="lazy" attributes in rendered elements */
/* Register Service Worker */
const JSON_FILE = 'menu-data.json'; // name you chose

// Elements
const brandNameEl = document.getElementById('brandName');
const brandSubtitleEl = document.getElementById('brandSubtitle');
const heroPreview = document.getElementById('heroPreview');
const promoVideo = document.getElementById('promoVideo');
const menuContainer = document.getElementById('menuContainer');
const menuContainer2 = document.getElementById('menuContainer2');
const combosContainer = document.getElementById('combosContainer');
const cartEl = document.getElementById('cart');
const totalEl = document.getElementById('total');
const waBtn = document.getElementById('whatsappBtn');
const cartCountEl = document.getElementById('cartCount');
const footerEl = document.getElementById('footerText');

let config = {};
let menu = [];
let combos = [];
let cart = [];

// LocalStorage keys
const LS_CART = 'nsb_cart_v1';
const LS_THEME = 'nsb_theme_v1';

// Helpers
function $(sel){ return document.querySelector(sel); }
function q(sel){ return document.querySelectorAll(sel); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function formatPrice(p){ return '‚Çπ' + Number(p).toFixed(0); }

// Load JSON
async function loadData(){
  try {
    const res = await fetch(JSON_FILE + '?t=' + Date.now());
    if (!res.ok) throw new Error('Could not load '+JSON_FILE);
    const data = await res.json();
    config = data.config || {};
    menu = data.menu || [];
    combos = data.combos || [];
    applyConfig();
    renderMenu();
    renderCombos();
    loadCart();
    renderCart();
  } catch (e) {
    console.error(e);
    alert('Error loading menu-data.json. Make sure the file exists and is valid JSON.');
  }
}

/* Apply top-level config (restaurant name, subtitle, videos, theme, whatsapp, footer) */
function applyConfig(){
  if (config.restaurantName) brandNameEl.textContent = config.restaurantName;
  if (config.subtitle) brandSubtitleEl.textContent = config.subtitle;
  if (config.heroVideo) {
    // update hero preview src
    setSource(heroPreview, config.heroVideo);
  }
  if (config.promoVideo) {
    setSource(promoVideo, config.promoVideo);
  }
  if (config.defaultTheme && config.defaultTheme === 'light') document.body.classList.add('light');
  if (config.footerText) footerEl.textContent = config.footerText;
}

/* utility to set <video> source */
function setSource(videoEl, src){
  videoEl.pause();
  while(videoEl.firstChild) videoEl.removeChild(videoEl.firstChild);
  const s = document.createElement('source');
  s.src = src;
  // try to infer type
  if (src.endsWith('.mp4')) s.type = 'video/mp4';
  else if (src.endsWith('.webm')) s.type = 'video/webm';
  videoEl.appendChild(s);
  videoEl.load();
}

/* Render menu: create DOM elements matching original HTML structure */
function renderMenu(){
  menuContainer.innerHTML = '';
  menuContainer2.innerHTML = '';

  // We'll group by category to mimic the headings (Main Dishes & Fried Specials)
  // If category is provided in JSON, use it; else place in first container.
  menu.forEach(item=>{
    const target = (item.category && item.category.toLowerCase().includes('fried')) ? menuContainer2 : menuContainer;
    const itemDiv = document.createElement('div');
    itemDiv.className = 'item';

    // Left: image + title + small
    const left = document.createElement('div');
    left.style.display = 'flex';
    left.style.alignItems = 'center';
    const img = document.createElement('img');
    img.className = 'menu-img';
    img.alt = item.title || '';
    img.src = item.image || 'images/placeholder.jpg';
    left.appendChild(img);

    const txt = document.createElement('div');
    txt.style.marginRight = '8px';
    const strong = document.createElement('strong');
    strong.innerHTML = escapeHtml(item.title || '');
    txt.appendChild(strong);
    if (item.badge) {
      const span = document.createElement('span');
      span.className = 'badge';
      span.textContent = item.badge;
      txt.appendChild(span);
    }
    if (item.variants && item.variants.length) {
      const small = document.createElement('div');
      small.innerHTML = '<small>' + item.variants.map(v=> escapeHtml(v.label) + ' ‚Çπ' + Number(v.price).toFixed(0)).join(' | ') + '</small>';
      txt.appendChild(small);
    } else if (item.price !== undefined) {
      const small = document.createElement('div');
      small.innerHTML = '<small>‚Çπ' + Number(item.price).toFixed(0) + '</small>';
      txt.appendChild(small);
    }
    left.appendChild(txt);

    // Right: variant buttons
    const actions = document.createElement('div');
    if (item.variants && item.variants.length){
      item.variants.forEach(variant=>{
        const btn = document.createElement('button');
        btn.className = 'cta add';
        btn.type = 'button';
        btn.dataset.title = item.title + ' (' + variant.label + ')';
        btn.dataset.price = Number(variant.price);
        btn.textContent = variant.label;
        actions.appendChild(btn);
      });
    } else {
      // single price fallback
      const btn = document.createElement('button');
      btn.className = 'cta add';
      btn.type = 'button';
      btn.dataset.title = item.title;
      btn.dataset.price = Number(item.price || 0);
      btn.textContent = 'Add';
      actions.appendChild(btn);
    }

    itemDiv.appendChild(left);
    itemDiv.appendChild(actions);
    target.appendChild(itemDiv);
  });
}

/* Render combos */
function renderCombos(){
  combosContainer.innerHTML = '';
  combos.forEach(c=>{
    const div = document.createElement('div');
    div.className = 'combo';
    div.setAttribute('data-title', c.title);
    div.setAttribute('data-price', c.price);

    const img = document.createElement('img');
    img.src = c.image || 'images/placeholder.jpg';
    img.alt = c.title || '';
    div.appendChild(img);

    const info = document.createElement('div');
    info.innerHTML = `<strong>${escapeHtml(c.title)}</strong>${c.badge ? ' <span class="badge">' + escapeHtml(c.badge) + '</span>' : ''}<br><small>${escapeHtml(c.description||'')}</small><br><span class="cprice">‚Çπ${Number(c.price||0).toFixed(0)}</span><br>`;
    const addBtn = document.createElement('button');
    addBtn.className = 'cta add';
    addBtn.type = 'button';
    addBtn.dataset.title = c.title;
    addBtn.dataset.price = Number(c.price||0);
    addBtn.textContent = 'Add';
    info.appendChild(addBtn);
    div.appendChild(info);
    combosContainer.appendChild(div);
  });
}

/* CART management (no duplicate event handlers, persisted) */
function loadCart(){
  try{ cart = JSON.parse(localStorage.getItem(LS_CART)) || []; }catch(e){ cart = []; }
}
function saveCart(){
  localStorage.setItem(LS_CART, JSON.stringify(cart));
  renderCart();
}
function addToCart(title, price){
  const found = cart.find(i=>i.title === title);
  if (found) found.qty += 1;
  else cart.push({ title, price: Number(price), qty: 1 });
  saveCart();
}
function changeQty(index, delta){
  if (cart[index]){
    cart[index].qty += delta;
    if (cart[index].qty <= 0) cart.splice(index,1);
    saveCart();
  }
}
function removeItem(index){
  if (index >= 0 && index < cart.length) { cart.splice(index,1); saveCart(); }
}
function clearCart(){
  cart = []; saveCart();
}
function cartTotals(){
  const total = cart.reduce((s,it)=> s + (Number(it.price) * Number(it.qty)), 0);
  return { total };
}
function renderCart(){
  cartEl.innerHTML = '';
  if (!cart.length){
    cartEl.innerHTML = '<small style="color:var(--muted);">No items yet</small>';
    totalEl.textContent = '‚Çπ0';
    cartCountEl.textContent = '0';
    waBtn.disabled = true;
    return;
  }
  let html = '';
  cart.forEach((c, i)=>{
    html += `<div class="cart-item"><div>${escapeHtml(c.title)} √ó${c.qty}</div>
      <div>‚Çπ${Number(c.price * c.qty).toFixed(0)}<button class="remove" data-idx="${i}" aria-label="Remove item">‚úï</button></div></div>`;
  });
  cartEl.innerHTML = html;
  const totals = cartTotals();
  totalEl.textContent = '‚Çπ' + Number(totals.total).toFixed(0);
  cartCountEl.textContent = cart.reduce((s,it)=> s + Number(it.qty), 0);
  waBtn.disabled = false;
}

/* Event delegation for add buttons and cart remove/qty */
document.addEventListener('click', (e) => {
  const addBtn = e.target.closest('.add');
  if (addBtn){
    const title = addBtn.dataset.title;
    const price = addBtn.dataset.price;
    addToCart(title, price);
    return;
  }
  const rem = e.target.closest('.remove');
  if (rem){
    const idx = Number(rem.dataset.idx);
    removeItem(idx);
    return;
  }
});

/* quantity controls via keyboard or other could be added if needed */

/* WhatsApp send (encoded + uses config.whatsappNumber) */
function sendWhatsApp(){
  const name = document.getElementById('custName').value.trim();
  const table = document.getElementById('tableNo').value.trim();
  if(!name || !table){
    alert('Please enter your name and table number.');
    return;
  }
  if (!cart.length){
    alert('Cart is empty');
    return;
  }
  const lines = [];
  lines.push('üßæ New Swadist Biryani Order');
  lines.push('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  lines.push('üë§ Name: ' + name);
  lines.push('ü™ë Table: ' + table);
  lines.push('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  cart.forEach(c=>{
    lines.push(`${c.title} √ó${c.qty} = ‚Çπ${Number(c.price * c.qty).toFixed(0)}`);
  });
  lines.push('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  lines.push('üí∞ Total: ‚Çπ' + Number(cartTotals().total).toFixed(0));
  lines.push('');
  lines.push('Thank you for dining with us! üôèüçó');

  const message = lines.join('\n');
  const phoneRaw = config.whatsappNumber || '917393956967';
  const phone = String(phoneRaw).replace(/[^\d+]/g, '');
  if (!phone) { alert('WhatsApp phone is not configured in menu-data.json'); return; }
  const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
  window.open(url, '_blank', 'noopener');
}
waBtn.addEventListener('click', sendWhatsApp);

/* Theme toggle (persist) */
const themeToggle = document.getElementById('themeToggle');
function initTheme(){
  const saved = localStorage.getItem(LS_THEME);
  if (saved === 'light') document.body.classList.add('light');
  else if (config.defaultTheme === 'light') document.body.classList.add('light');
  updateThemeText();
}
function toggleTheme(){
  document.body.classList.toggle('light');
  const mode = document.body.classList.contains('light') ? 'light' : 'dark';
  localStorage.setItem(LS_THEME, mode);
  updateThemeText();
}
function updateThemeText(){
  themeToggle.textContent = document.body.classList.contains('light') ? "üåô Dark Mode" : "üåû Light Mode";
}
themeToggle.addEventListener('click', toggleTheme);

/* Floating cart scroll */
document.getElementById('floatingCart').addEventListener('click', () => {
  cartEl.scrollIntoView({behavior:'smooth'});
});

/* Video modal open/close */
const modal = document.getElementById('vidModal');
document.getElementById('openVid').addEventListener('click', () => {
  modal.classList.add('show');
  modal.setAttribute('aria-hidden','false');
});
document.getElementById('closeVid').addEventListener('click', () => {
  modal.classList.remove('show');
  modal.setAttribute('aria-hidden','true');
});
modal.addEventListener('click', (e) => { if (e.target === modal) { modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); } });

/* init */
initTheme();
loadData();

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(reg => console.log('‚úÖ Service Worker registered:', reg.scope))
      .catch(err => console.log('‚ö†Ô∏è SW registration failed:', err));
  });
}
</script>
</body>
</html>
